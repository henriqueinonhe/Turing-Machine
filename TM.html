<!DOCTYPE html>
<html>
<head>
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<meta charset="utf-8">
	<script type="text/javascript" src="TM.js"></script>
	<title>Turing Machine</title>
	<style type="text/css">

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: Roboto;
			color: #333;
		}

		input, textarea, button {
			display: block;
			width: 100%;
		}

		textarea {
			height: 200px;
		}

		input {
			text-align: center;
		}

		button {
			background-color: #9FDEEB;
			border: solid #CCC 1px;
			padding: 5px;
			margin-top: 10px;
		}

		button:hover {
			background-color: #D6F9FB;
			transition: 0.4s;
		}

		p {
			text-align: center;
		}

		#user-area {
			position: fixed;
			right: 0;
			width: 30%;
			padding: 10px;
		}

		#print-area {
			width: 100%;
			margin: auto;
			text-align: center;
		}

		.tape {
		}

		.instruction {
			margin-left: 20px;
		}

		.number {
			margin-right: 20px;
		}


	</style>
	<script
  src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
  crossorigin="anonymous"></script>
</head>
<body>
	<div id="user-area">
		<p>Input</p>
		<input type="text" id="data-input">
		<p>Instructions</p>
		<textarea id="instructions-input"></textarea>
		<p>Initial Instruction Id</p>
		<input type="text" id="initial-input">
		<button id="set-button">Set!</button>
		<button id="run-button">Run!</button>
	</div>

	<div id="print-area">
		
	</div>
</body>
<script type="text/javascript">
let machine;
let lineCount = 1;

document.addEventListener("DOMContentLoaded", main);

function cleanPrintArea()
{
    document.querySelector("#print-area").innerHTML = "";
    lineCount = 0;
}

function setMachine()
{
    const input = document.querySelector("#data-input").value;
    const instructions = document.querySelector("#instructions-input").value;
    const initialInstructionId = parseInt(document.querySelector("#initial-input").value);

    try
    {
        machine = new Machine(input, instructions, initialInstructionId);
    }
    catch(err)
    {
        alert(err);
    }

    cleanPrintArea();
}

function printLine()
{
    const logger = machine.logger;
    console.log(logger);
    let html = "";
    const tape = logger.lastEntry().tape;
    const currentInstruction = logger.lastEntry().currentInstruction;
    const headIndex = logger.lastEntry().headIndex;

    html = `<div>
    		<span class='number'>${lineCount}.</span>`;

    for(let i = 0; i < tape.length; i++)
    {
        id = `${lineCount}_${i + 1}`;
        html += `<span class='tape' id='${id}'>${tape.charAt(i)}</span>`;
    }

    html += `<span class='instruction'>${currentInstruction}</span>
     		 <div>`;

    document.querySelector("#print-area").innerHTML += html;

    const id = `#${lineCount}_${headIndex + 1}`;
    document.querySelector(id).style.backgroundColor = "yellow";
    lineCount++;
}

function main()
{
    //Program
    const setButton = document.querySelector("#set-button");
    const runButton = document.querySelector("#run-button");
    setButton.addEventListener("click", setMachine);
   	runButton.addEventListener("click", function ()
    {
        try
        {
            if(machine.status === "running")
            {
                machine.run();
                printLine(machine.logger);
            }
            else if(machine.status === "halted")
            {
                throw "Machine is halted!";
            }
        }
        catch(err)
        {
        	console.log(err);
            alert(err);
        }
    });


}

</script>
</html>