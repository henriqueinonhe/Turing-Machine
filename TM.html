<!DOCTYPE html>
<html>
<head>
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<meta charset="utf-8">
	<script type="text/javascript" src="TM.js"></script>
	<title>Turing Machine</title>
	<style type="text/css">

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: Roboto;
			color: #333;
		}

		body {
			padding-bottom: 500px;
		}

		input, textarea, button {
			display: block;
			width: 100%;
		}

		textarea {
			height: 200px;
		}

		input {
			text-align: center;
		}

		button {
			background-color: #9FDEEB;
			border: solid #CCC 1px;
			padding: 5px;
			margin-top: 10px;
		}

		button:hover {
			background-color: #D6F9FB;
			transition: 0.4s;
		}

		p {
			text-align: center;
		}

		#user-area {
			position: fixed;
			right: 0;
			width: 30%;
			padding: 10px;
		}

		#print-area {
			width: 100%;
			margin: auto;
			text-align: center;
		}

		.tape {
		}

		.instruction {
			margin-left: 20px;
		}

		.number {
			margin-right: 20px;
		}

		#examples {
			margin-top: 20px;
		}


	</style>
	<script
  src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
  crossorigin="anonymous"></script>
</head>
<body>
	<div id="user-area">
		<p>Input</p>
		<input type="text" id="data-input">
		<p>Instructions</p>
		<textarea id="instructions-input"></textarea>
		<p>Initial Instruction Id</p>
		<input type="text" id="initial-input">
		<button id="set-button">Set!</button>
		<button id="run-button">Run!</button>
		<div id="examples">
			<p>Examples</p>
			<button id="go-right-button">Go Right</button>
			<button id="go-left-button">Go Left</button>
			<button id="write-one-button">Write One</button>
			<button id="alternate-one-and-zero-button">Alternate One and Zero</button>
			<button id="sum-button">Sum</button>
		</div>
	</div>

	<div id="print-area">
		
	</div>
</body>
<script type="text/javascript">
let machine;
let lineCount = 1;

document.addEventListener("DOMContentLoaded", main);

function cleanPrintArea()
{
    document.querySelector("#print-area").innerHTML = "";
    lineCount = 0;
}

function setMachine()
{
    const input = document.querySelector("#data-input").value;
    const instructions = document.querySelector("#instructions-input").value;
    const initialInstructionId = parseInt(document.querySelector("#initial-input").value);

    try
    {
        machine = new Machine(input, instructions, initialInstructionId);
    }
    catch(err)
    {
        alert(err);
    }

    cleanPrintArea();
}

function printLine()
{
    const logger = machine.logger;
    let html = "";
    const tape = logger.lastEntry().tape;
    const currentInstruction = logger.lastEntry().currentInstruction;
    const headIndex = logger.lastEntry().headIndex;

    html = `<div>
    		<span class='number'>${lineCount}.</span>`;

    for(let i = 0; i < tape.length; i++)
    {
        html += `<span class='tape' id='line${lineCount}_${i + 1}'>${tape.charAt(i)}</span>`;
    }

    html += `<span class='instruction'>${currentInstruction}</span>
     		 <div>`;

    document.querySelector("#print-area").innerHTML += html;

    const id = `#line${lineCount}_${headIndex + 1}`;
    document.querySelector(id).style.backgroundColor = "yellow";
    lineCount++;
}

function setExample({input, instructions, initialInstruction})
{
	console.log(input);
	document.querySelector("#data-input").value = input;
    document.querySelector("#instructions-input").value = instructions;
    document.querySelector("#initial-input").value = initialInstruction;
}

//Examples Data
const goRightData = {input : "0",
					 instructions : "0,0,R,0",
					 initialInstruction: "0"};

const goLeftData = {input : "0",
					instructions : "0,0,L,0",
					initialInstruction: "0"};

const writeOneData = {input : "0",
					  instructions : "0,0,1,0\n0,1,R,0",
					  initialInstruction: "0"};

const alternateOneAndZeroData = {input : "0",
					             instructions : "0,0,1,0\n0,1,R,1\n1,0,R,0",
					             initialInstruction: "0"};

const sumData = {input : "11111011",
                 instructions : `0,1,R,0\n0,0,R,1\n1,1,0,2\n1,0,0,999\n2,0,L,3\n3,0,1,4\n4,1,L,4\n4,0,R,0`,
                 initialInstruction: "0"};

function main()
{
    //Program
    const setButton = document.querySelector("#set-button");
    const runButton = document.querySelector("#run-button");
    setButton.addEventListener("click", setMachine);
   	runButton.addEventListener("click", function ()
    {
        try
        {
            if(machine.status === "running")
            {
                machine.run();
                printLine(machine.logger);
            }
            else if(machine.status === "halted")
            {
                throw "Machine is halted!";
            }
        }
        catch(err)
        {
        	console.log(err);
            alert(err);
        }
    });

   	//Examples
   	const goRightButton = document.querySelector("#go-right-button");
   	const goLeftButton = document.querySelector("#go-left-button");
   	const writeOneButton = document.querySelector("#write-one-button");
   	const alternateOneAndZeroButton = document.querySelector("#alternate-one-and-zero-button");
   	const sumButton = document.querySelector("#sum-button");

   	goRightButton.addEventListener("click", () => {setExample(goRightData);});
   	goLeftButton.addEventListener("click", () => {setExample(goLeftData);});
   	writeOneButton.addEventListener("click", () => {setExample(writeOneData);});
   	alternateOneAndZeroButton.addEventListener("click", () => {setExample(alternateOneAndZeroData);});
   	sumButton.addEventListener("click", () => {setExample(sumData);});
}



</script>
</html>